openapi: 3.0.0
info:
  version: 1.0.0
  title: Predator
  x-logo:
    url: logo.png
    backgroundColor: white
  description: |
    # Overview

    Predator is an open-source performance framework. It manages the entire
    lifecycle of load testing a server, from creating a test file, running
    scheduled and on-demand tests, and finally viewing the test results.
    Developers who want to load their system end-to-end or test a specific
    service will benefit from this framework. Bootstrapped with a user-friendly
    UI alongside a simple REST API, Predator simplifies the performance testing
    regime.

    For an introduction to Predator and its concepts, see the <a href="https://www.zooz.com" target="_blank">Predator Documentation</a>.

tags:
  - name: DSL Definitions
    description: |
      Predator's Domain Specific Language (DSL) allows you to generate request templates, which you can then reuse in the same test and in other tests, reducing replication.
  - name: Tests
    description: |
      Tests include end-to-end scenarios that are executed at pre-configured intervals to provide in-depth performance metrics of your API.
  - name: Jobs
    description: |
      Predator executes tests through so-called **jobs**. Depending on your configuration, the job will either execute immediately or at scheduled intervals.
  - name: Reports
    description: |
      Reports give you insight into the performance of your API. Predator generates a report for each test that is executed.
  - name: Configuration
    description: |
      This resource allows you to configure Predator programmatically.
x-tagGroups:
  - name: Reference
    tags:
      - DSL Definitions
      - Tests
      - Jobs
      - Reports
      - Configuration

paths:
  #DSL Definitions
  '/v1/dsl/{dsl_name}/definitions':
    parameters:
      - $ref: '#/components/parameters/dsl_name'
    post:
      operationId: create-a-dsl-definition
      tags:
        - DSL Definitions
      summary: Create a DSL Definition
      description: Create a new DSL definition to generate a request template.
      responses:
        '201':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/definition'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '422':
          description: Unprocessable entity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/definition'
        description: The definition to create
        required: true
    get:
      operationId: retrieve-all-dsl-definitions
      tags:
        - DSL Definitions
      summary: Retrieve all DSL Definitions
      description: Retrieve all DSL definitions for the specified DSL group name.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/definitions_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  '/v1/dsl/{dsl_name}/definitions/{definition_name}':
    parameters:
      - $ref: '#/components/parameters/dsl_name'
      - $ref: '#/components/parameters/definition_name'
    get:
      operationId: retrieve-a-dsl-definition
      tags:
        - DSL Definitions
      summary: Retrieve a DSL Definition
      description: Retrieve a specific DSL definition.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/definition'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
    put:
      operationId: update-a-dsl-definition
      tags:
        - DSL Definitions
      summary: Update a DSL Definition
      description: Update a specific DSL definition.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/definition'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/update_definition'
        description: The DSL definition to update
        required: true
    delete:
      operationId: Delete-a-dsl-definition
      tags:
        - DSL Definitions
      summary: Delete a DSL Definition
      description: Delete a specific DSL definition.
      responses:
        '204':
          description: Success
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  # Tests
  /v1/tests:
    post:
      operationId: create-a-test
      tags:
        - Tests
      summary: Create a Test
      description: Create a new test.
      responses:
        '201':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/create_test_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '422':
          description: Unprocessable entity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/test'
        description: The test to add
        required: true
    get:
      operationId: retrieve-all-tests
      tags:
        - Tests
      summary: Retrieve all Tests
      description: Retrieve all available tests.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/tests_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  /v1/tests/{test_id}/benchmark:
    post:
      tags:
        - Tests
      parameters:
        - in: path
          name: test_id
          description: The test id.
          required: true
          schema:
            type: string
            format: uuid
            example: 4bf5d7ab-f310-4a64-8ec2-d65c06188ec1
      summary: Create a bench mark for test
      description: Create a bench mark for test
      responses:
        '201':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benchmark_request'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/benchmark_request'
        description: The bench mark to add
        required: true
  '/v1/tests/{test_id}':
    get:
      operationId: retrieve-a-test
      tags:
        - Tests
      summary: Retrieve a Test
      description: Retrieve a specific test.
      parameters:
        - in: path
          name: test_id
          description: The test id.
          required: true
          schema:
            type: string
            format: uuid
            example: 4bf5d7ab-f310-4a64-8ec2-d65c06188ec1
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/tests_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
    put:
      operationId: update-a-test
      tags:
        - Tests
      summary: Update a Test
      description: Update a specific test.
      parameters:
        - in: path
          name: test_id
          description: The test id.
          required: true
          schema:
            type: string
            example: 4bf5d7ab-f310-4a64-8ec2-d65c06188ec1
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/create_test_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/test'
        description: The test to update
        required: true
    delete:
      operationId: delete-a-test
      tags:
        - Tests
      summary: Delete a Test
      description: Delete a specific test.
      parameters:
        - in: path
          name: test_id
          description: The test id.
          required: true
          schema:
            type: string
            example: 4bf5d7ab-f310-4a64-8ec2-d65c06188ec1
      responses:
        '200':
          description: Success
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  '/v1/tests/{test_id}/revisions':
    get:
      operationId: retrieve-all-test-revisions
      tags:
        - Tests
      summary: Retrieve Test Revisions
      description: Retrieve the revisions of the specified test.
      parameters:
        - in: path
          name: test_id
          description: The test id.
          required: true
          schema:
            type: string
            format: uuid
            example: 4bf5d7ab-f310-4a64-8ec2-d65c06188ec1
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/tests_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  # Jobs
  /v1/jobs:
    post:
      operationId: create-a-job
      tags:
        - Jobs
      summary: Create a Job
      description: Create a new job that will trigger a test run.
      responses:
        '201':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/create_job_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/job'
        description: The job to add
        required: true
    get:
      operationId: retrieve-all-jobs
      tags:
        - Jobs
      summary: Retrieve all Jobs
      description: Retrieve the details of all available jobs.
      parameters:
        - in: query
          name: one_time
          description: Should return the one time tests (no cron expression)
          schema:
            type: boolean
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/job_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'

  '/v1/jobs/{job_id}':
    get:
      operationId: retrieve-a-job
      tags:
        - Jobs
      summary: Retrieve a Job
      description: Retrieve a specific job.
      parameters:
        - in: path
          name: job_id
          description: The id of the job to retrieve.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/job_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
    put:
      operationId: update-a-job
      tags:
        - Jobs
      summary: Update a Job
      description: Update a specific job.
      parameters:
        - in: path
          name: job_id
          description: The id of the job to update.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/job_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/job_update'
        description: The job to add
        required: true
    delete:
      operationId: delete-a-job
      tags:
        - Jobs
      summary: Delete a Job
      description: Delete a specific job.
      parameters:
        - in: path
          name: job_id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Success
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  '/v1/jobs/{job_id}/runs/{run_id}/stop':
    post:
      operationId: terminate-a-job
      tags:
        - Jobs
      summary: Terminate a Job
      description: Terminate the execution of a running job.
      parameters:
        - in: path
          description: The ID of the job.
          name: job_id
          required: true
          schema:
            type: string
        - in: path
          description: The id of a specific run in metronome which is also the report id.
          name: run_id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Success
        '404':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  /v1/jobs/{job_id}/runs/{run_id}/logs:
    get:
      tags:
        - Jobs
      description: Get logs of specific job.
      parameters:
        - in: path
          description: The ID of the job.
          name: job_id
          required: true
          schema:
            type: string
        - in: path
          description: The id of a specific run in metronome which is also the report id.
          name: run_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Success
        "404":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/error_response"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/error_response"
        "501":
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/error_response"

  '/v1/jobs/containers/':
    delete:
      operationId: Delete all finished containers/pods
      tags:
        - Jobs
      description: delete all containers/pods of predator-runner
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/delete_containers_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  # Reports
  '/v1/tests/{test_id}/reports':
    get:
      operationId: retrieve-all-reports
      tags:
        - Reports
      summary: Retrieve all Reports
      description: Retrieve all reports for the specified test.
      parameters:
        - in: path
          name: test_id
          description: The id of the test for which to retrieve the reports.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/report_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
    post:
      operationId: create-a-report
      tags:
        - Reports
      summary: Create a Report
      description: Create a new report for the specified test.
      parameters:
        - in: path
          name: test_id
          required: true
          schema:
            type: string
      responses:
        '201':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/post_report_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/post_report'
        description: report data
        required: true
  '/v1/tests/{test_id}/reports/{report_id}':
    get:
      operationId: retrieve-a-report
      tags:
        - Reports
      summary: Retrieve a Report
      description: Retrieve a specific report for the specified test.
      parameters:
        - in: path
          name: test_id
          required: true
          description: The id of the test for which to retrieve the report.
          schema:
            type: string
            example: 81a27853-0db5-4e57-ad63-4b637528398a
        - in: path
          name: report_id
          description: The id of the report to retrieve.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/report_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
    put:
      operationId: edit-a-report
      tags:
      - Reports
      summary: edit a Report
      description: edit a specific report for the specified test.
      parameters:
      - in: path
        name: test_id
        required: true
        description: The id of the test for which to retrieve the report.
        schema:
          type: string
          example: 81a27853-0db5-4e57-ad63-4b637528398a
      - in: path
        name: report_id
        description: The id of the report to retrieve.
        required: true
        schema:
          type: string
      responses:
        '204':
          description: Success

        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/edit_report'
        description: report data
        required: true
  /v1/tests/last_reports:
    get:
      operationId: retrieve-recent-reports
      tags:
        - Reports
      summary: Retrieve Recent Reports
      description: Retrieve the most recent reports.
      parameters:
        - in: query
          name: limit
          description: The number of most recent reports to retrieve.
          required: true
          minimum: 1
          maximum: 250
          type: integer
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/report_response'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
  '/v1/tests/{test_id}/reports/{report_id}/stats':
    post:
      tags:
        - Reports
      summary: Insert a Stats Object
      description: Insert a new stats object for a specific report
      parameters:
        - in: path
          name: test_id
          required: true
          schema:
            type: string
        - in: path
          name: report_id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Success
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error_response'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/stats'
        description: stats data
        required: true
  # Config
  /v1/config:
    get:
      operationId: retrieve-configurations
      tags:
        - Configuration
      summary: Retrieve Configuration Settings
      description: Retrieve all Predator configuration settings.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/config_body"
        "500":
          description: Internal server error
    put:
      operationId: update-configurations
      tags:
        - Configuration
      summary: Update Configuration Settings
      description: Update existing configuration settings. This will override environment variables.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/config_body"
        description: The config data to add
        required: true
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/config_body"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/error_response"
  /v1/config/{config_key}:
    delete:
      operationId: delete-a-configuration
      tags:
        - Configuration
      summary: Delete a Specific Configuration Value
      description: |
        Delete a specific configuration value. This will restore the original
        environment variable.
      parameters:
        - in: path
          name: config_key
          required: true
          description: They key to delete.
          schema:
            type: string
      responses:
        "204":
          description: Success
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/error_response"

components:
  parameters:
    dsl_name:
      name: dsl_name
      in: path
      required: true
      description: The group (category) in which the DSL definition will be created. Specify a group name of your choice. We recommend you place related DSL definitions in the same group.
      schema:
        type: string
      example: petstore
    definition_name:
      name: definition_name
      in: path
      required: true
      description: The name of the DSL definition.
      schema:
        type: string
      example: create-pet
  schemas:
    definition:
      type: object
      required:
        - name
        - request
      properties:
        name:
          description: The name of the DSL definition.
          type: string
          example: create-pet
        request:
          description: The request template that the DSL definition will generate.
          type: object
          additionalProperties:
            $ref: '#/components/schemas/artillery_request_schema'
          example: {
            "name": "create-pet",
            "request": {
              "post": {
                "url": "http://127.0.0.1:3000/pets",
                "headers": {
                  "Content-Type": "application/json"
                },
                "json": {
                  "name": "mickey",
                  "species": "dog"
                },
                "capture": [
                {
                  "json": "$.id",
                  "as": "petId"
                }
                ]
              }
            }
          }
    update_definition:
      required:
        - request
      properties:
        request:
          type: object
          description: The request template that the DSL definition will generate.
          additionalProperties:
            $ref: '#/components/schemas/artillery_request_schema'
    definitions_response:
      type: array
      items:
        $ref: '#/components/schemas/definition'
    test:
      type: object
      discriminator:
        propertyName: type
      required:
        - name
        - description
        - type
      properties:
        name:
          type: string
          description: The name of the test.
          example: Order from Pet Store
        description:
          type: string
          description: A description of the test.
          example: Performance test for placing orders from the pet store.
        type:
          $ref: '#/components/schemas/test_type'
    test_type:
      type: string
      description: |
        The type of test. Can be one of the following:
        * `basic`: Tests of this type cannot reuse request templates (DSL definition). All request specifications must be directly included in the test itself.
          This test type is identical to the type of tests you can create through the Predator UI.
        * `dsl`: Tests of this type reuse request templates based on previously created DSL definitons.
      example: dsl
    benchmark_request:
      type: object
      additionalProperties: false
      properties:
        errors:
          type: object
          example:
            ECONNREFUSED: 33
            CLIENTERROR: 10
        codes:
          type: object
          example:
            200: 161
            201: 1061
            500: 53
        rps:
          type: object
          properties:
            count:
              type: number
            mean:
              type: number
        latency:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            median:
              type: number
            p95:
              type: number
            p99:
              type: number
    dsl:
      description: A test that is made of scenarios base on domain specific language
      allOf:
        - $ref: '#/components/schemas/test'
      required:
        - scenarios
      properties:
        scenarios:
          description: A scenario is a sequence of HTTP requests aimed to test the performance of specific functionality.
          type: array
          items:
            $ref: '#/components/schemas/scenario'
    processor_file_url:
      type: string
      format: uri
      example: http://www.example.com/file.txt
      description: The URL path to a text file holding custom Javascript code.
    artillery_request_schema:
      description: |
        The request schema used in test scenarios. The property name must be one of the following HTTP methods: `GET`, `HEAD`, `POST`, `PUT`, `DELETE`.

        **Beware**: Specifying an invalid property name will return an error.
      type: object
      properties:
        capture:
          description: |
            Allows you to extract (capture) data from the request response and store it in a variable for reuse in another request.
            Must include one or more objects with a `json` attribute specifying the data to extract (using JSONPath syntax), as well as an `as` attribute specifying the variable name in which to store the extracted data.
          type: array
          items:
            type: object
            additionalProperties:
              type: string
        url:
          description: The endpoint against which the request will be executed.
          type: string
        headers:
          description: The headers to pass in the request.
          additionalProperties:
            type: string
        json:
          description: The JSON body to use in the request.
          type: object
    key_value_string_object:
      type: object
      additionalProperties:
        type: string
    basic:
      description: A test that is made of artillery json
      allOf:
        - $ref: '#/components/schemas/test'
      required:
        - artillery_test
      properties:
        artillery_test:
          type: object
          description: |
            The complete request JSON used in the test.
          example: {
            "artillery_test": {
              "config": {
                "target": "http://127.0.0.1:3000"
              },
              "scenarios": [
              {
                "name": "Get Pets",
                "weight": 100,
                "flow": [
                {
                  "post": {
                    "url": "/pets",
                    "headers": {
                      "Content-Type": "application/json",
                      "request-id": "{{ $randomString() }}"
                    },
                    "capture": [
                    {
                      "json": "$.id",
                      "as": "petId"
                    }
                    ],
                    "json": {
                      "name": "Mickey"
                    }
                  }
                },
                {
                  "get": {
                    "url": "/pets/{{petId}}",
                    "headers": {
                      "Content-Type": "application/json",
                      "request-id": "{{ $randomString() }}"
                    }
                  }
                }
                ]
              }
              ]
            },
            "name": "Order from Pet Store",
            "description": "Performance test for placing orders from the pet store.",
            "type": "basic"
          }
    test_id:
      required:
        - id
      properties:
        id:
          type: string
          format: uuid
          description: The id of the test.
    create_test_response:
      allOf:
        - $ref: '#/components/schemas/test_id'
      required:
        - revision_id
      properties:
        revision_id:
          type: string
          format: uuid
          description: |
            The test's revision ID.

            When a test is created, it is assigned a revision ID. If you update a test, then it's revision ID changes as well. This allows Predator to always relate an existing report to the test it was originally based on.
    tests_response:
      type: object
      discriminator:
        propertyName: type
        mapping:
          dsl: '#/components/schemas/dsl_test_response'
          basic: '#/components/schemas/basic_test_response'
      required:
        - type
        - name
        - description
        - updated_at
      properties:
        type:
          $ref: '#/components/schemas/test_type'
        updated_at:
          type: string
          format: date-time
          description:   The date and time that the test was created.
        name:
          type: string
          description: The name of the test.
        description:
          type: string
          description: The description of the test.
    dsl_test_response:
      type: object
      description: A test that is made of scenarios base on domain specific language
      allOf:
        - $ref: '#/components/schemas/create_test_response'
          required:
            - raw_data
      properties:
        raw_data:
          type: object
          description: The entire specification of the DSL that was used to create the test.
          example: {
            "name": "Pet store",
            "description": "DSL",
            "type": "dsl",
            "before": {
              "steps": [
              {
                "action": "petstore.create-pet",
                "properties": {
                  "name": [
                    "kushkush",
                    "daisy"
                  ]
                }
              }
              ]
            },
            "scenarios": [
            {
              "scenario_name": "Only get pet",
              "steps": [
              {
                "action": "petstore.get-pet"
              }
              ]
            }
            ]
          }
        artillery_test:
          type: object
          description: |
            The request JSON created from the DSL specification (as returned in the `raw_data` array).
          example:  {
            "config": {
              "target": "",
              "http": {
                "pool": 100
              },
              "phases": [
              {
                "duration": 0,
                "arrivalRate": 0,
                "rampTo": 0
              }
              ],
              "variables": {
                "before_0_petstore.create-pet_name": [
                  "kushkush",
                  "daisy"
                ]
              }
            },
            "scenarios": [
            {
              "name": "Only get pet",
              "flow": [
              {
                "get": {
                  "url": "http://127.0.0.1:3000/pets/{{petId}}"
                }
              }
              ],
              "weight": 100
            }
            ],
            "before": {
              "flow": [
              {
                "post": {
                  "url": "http://127.0.0.1:3000/pets",
                  "json": {
                    "name": "{{ before_0_petstore.create-pet_name }}",
                    "species": "dog"
                  },
                  "capture": [
                  {
                    "json": "$.id",
                    "as": "petId"
                  }
                  ],
                  "headers": {
                    "Content-Type": "application/json"
                  }
                }
              }
              ]
            }
          }
    basic_test_response:
      type: object
      allOf:
        - $ref: '#/components/schemas/create_test_response'
        - type: object
          required:
            - artillery_test
      properties:
        artillery_test:
          type: object
          description: |
            The complete request JSON used in the test.
          example: {
            "config": {
              "target": "http://127.0.0.1:3000"
            },
            "scenarios": [
            {
              "name": "Get Pets",
              "weight": 100,
              "flow": [
              {
                "get": {
                  "url": "/pets",
                  "headers": {},
                  "capture": []
                }
              }
              ]
            }
            ]
          }
    error_response:
      required:
        - message
      properties:
        message:
          type: string
    scenario:
      required:
        - scenario_name
        - steps
      properties:
        scenario_name:
          type: string
          description: The name of the scenario.
          example: Get Inventory
        steps:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - action
            properties:
              action:
                type: string
                description: |
                  A reference to the DSL definition you want to use. Uses the following syntax: `{dsl_group_name}.{dsl_name}`.
                example: petstore.create-pet
              properties:
                type: object
                description: |
                  Allows you to replace a request's body's property value when the test is executed. `properties` must be an object of key-value pairs.
                  Each key you specify must correspond to the name you specified in the `json` object of the [Create a DSL Defintion](/#operation/create-a-dsl-definition) request.
                  The value must be an `array` of the values that should be used during test execution (when specifying multiple values, the value to be used will be selected randomly).,
                example: {
                  "name":
                    [
                      "kushkush",
                      "daisy"
                    ]
                }
              wait:
                type: integer
                description: The time to wait before starting the request. In seconds.
                example: 2
            description: An object that represent an action.
          description: An array of the scenario steps. Steps are the HTTP requests that make up the scenario.
        weight:
          type: number
          description: |
            Allows for the probability (in %) of a scenario being picked by a new virtual user to be "weighed" relative to other scenarios. If not specified, each scenario is equally likely to be picked.
          example: 20
    job:
      required:
        - test_id
        - arrival_rate
        - duration
      allOf:
        - $ref: '#/components/schemas/job_update'
        - type: object
      properties:
        run_immediately:
          type: boolean
          description: Determines if the test will be executed immediately when the job is created.
          example: true
    job_update:
      properties:
        test_id:
          type: string
          pattern: >-
            ^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$
          description: The id of the test to schedule.
          example: 4bf5d7ab-f310-4a64-8ec2-d65c06188ec1
        cron_expression:
          type: string
          description: A cron expression for scheduling the test to run periodically at a specified date/time.
          example: 0 0 12 * * ?
        webhooks:
          type: array
          description: |
            A URL to which an event will be sent when the test execution is completed.
            The event body will include detailed information about the test, such as the number of scenarios that were executed and the number of requests that were invoked.
          items:
            type: string
            description: The url of where to send the webhook with the report information
        arrival_rate:
          type: number
          minimum: 1
          description: The number of times per second that the test scenarios will run.
        duration:
          type: number
          minimum: 1
          description: The time during which the test will run. In seconds.
          example: 20
        ramp_to:
          type: number
          minimum: 1
          description: |
            Used in combination with the `arrival_rate` and `duration` values. Increases the arrival rate linearly to the value specified, within the specified duration.
          example: 5
        max_virtual_users:
          type: number
          minimum: 1
          description: |
            The maximum number of virtual users executing the scenario requests. This places a threshold on the number of requests that can exist simultaneously.
          example: 5
        parallelism:
          type: number
          minimum: 1
          description: |
            The number of runners that will be allocated to executing the test. The `arrival_rate`, `duration` and `max_virtual_users` will be split between the specified number of runners.
          example: 5
        emails:
          type: array
          description: An email address to which Predator will send a message when the test execution is completed.
          items:
            type: string
            example: nhoj@atlovart.com
        environment:
          type: string
          description: Free text describing the environment against which the test is executed.
          example: test
        proxy_url:
          type: string
          description: URL of the proxy server that predator runners will use
          example: test
        debug:
          type: string
          description: set to * in order to print all requests and responeses of the runner
          example: test
        enabled:
          type: boolean
          description: Ability to enable/disable scheduled jobs.
          example: true
          default: true
    delete_containers_response:
      required:
        - deleted
      properties:
        deleted:
          type: number
          description: Number of deleted containers.
    job_response:
      allOf:
        - $ref: '#/components/schemas/job'
        - properties:
            id:
              type: string
              pattern: >-
                ^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$
                description: The job id.
    create_job_response:
      allOf:
        - $ref: '#/components/schemas/job_response'
        - properties:
            run_id:
              type: string
              description: The run id. Only shown if the job is ran immediately.
    edit_report:
      additionalProperties: false
      properties:
        notes:
          type: string
          description: notes for specific report

    post_report:
      required:
        - report_id
        - job_id
        - revision_id
        - test_type
        - test_name
        - test_description
        - start_time
        - runner_id
      properties:
        report_id:
          type: string
          description: The id of the report/same as run_id
        test_id:
          type: string
          description: The id of the test we would like to schedule.
        revision_id:
          type: string
          description: The revision id of the test
        job_id:
          type: string
          description: The id of the job in the scheduler
        test_name:
          type: string
          description: The test name
        test_description:
          type: string
          description: The test description
        start_time:
          type: string
          description: When the test started
        last_stats:
          type: object
          description: The current report metrics.
        notes:
          type: string
          description: notes about the test
        runner_id:
          type: string
          description: the id of the runner that created the report
    post_report_response:
      required:
        - report_id
      properties:
        report_id:
          type: string
          description: The id of the report/same as run_id
    stats:
      required:
        - stats_time
        - phase_status
        - data
      properties:
        stats_time:
          type: string
          description: The time the stats were taken of the test
        phase_status:
          type: string
          description: The phase status of the test
        phase_index:
          type: string
          description: The phase number the test is running
        data:
          type: string
          description: The stats data
        error:
          type: object
          description: Error thrown while running test
    report_response:
      required:
        - test_id
        - revision_id
        - report_id
        - job_id
        - test_type
        - status
        - start_time
        - end_time
        - duration_seconds
        - arrival_rate
      properties:
        test_id:
          type: string
          description: The test id.
        revision_id:
          type: string
          description: The revision id of the test.
        report_id:
          type: string
          description: The report id.
        job_id:
          type: string
          description: The job id.
        test_type:
          $ref: '#/components/schemas/test_type'
        status:
          type: string
          description: The status of the running test.
        start_time:
          type: string
          format: date
          description: The date and time that the test started its execution.
        end_time:
          type: string
          format: date
          description: The date and time that the test execution ended.
        duration_seconds:
          type: number
          description: The duration of the test in seconds.
          example: 60
        arrival_rate:
          type: number
          description: The arrival rate that was set for the test. This is the number of times per second that the test scenarios will run.
        last_stats:
          type: string
          description: The current report metrics.
        notes:
          type: string
          description: notes about the test
    config_body:
      additionalProperties: false
      properties:
        grafana_url:
          type: string
          description: The url for grafana.
        internal_address:
          type: string
          description: The local ip address of your machine.
        runner_docker_image:
          type: string
          description: The predator-runner docker image that will run the test.
        job_platform:
          type: string
          description: Type of platform using to run predator (METRONOME,KUBERNETES,DOCKER)
        runner_cpu:
          minimum: 0
          type: number
          description: Number of CPU use by the each runner.
        runner_memory:
          type: number
          minimum: 128
          description: Max memory to use by each runner.
        allow_insecure_tls:
          type: boolean
          description: If true, don't fail requests on unverified server certificate errors.
        metrics_plugin_name:
          type: string
          enum:
            - influx
            - prometheus
          description: Metrics to use, in case one or both metrics are configured.
        default_email_address:
          type: string
          description: Default email to send final report to, address can be configured
            only by using API.
        minimum_wait_for_delayed_report_status_update_in_ms:
          minimum: 0
          type: number
          description: The minimum of time waiting for runner to report before the test considered as finished.
            configured only by using API.
        default_webhook_url:
          type: string
          description: Default webhook url to send live report statistics to, can be
            configured only by using API.
        delay_runner_ms:
          type: number
          minimum: 0
          description: Delay before the runners will start the test,
            useful for enviroments like kubernetes with sidecars that should be
            initialized before the runner starts
        influx_metrics:
          additionalProperties: false
          type: object
          description: Influx configuration  .
          required:
            - host
            - username
            - password
            - database
          properties:
            host:
              type: string
              description: Influx host.
            username:
              type: string
              description: User name to influx.
            password:
              type: string
              description: Password name to influx.
            database:
              type: string
              description: Influx db name.
        prometheus_metrics:
          additionalProperties: false
          type: object
          description: prometheus configuration.
          required:
            - push_gateway_url
          properties:
            push_gateway_url:
              type: string
              description: Url of push gateway.
            buckets_sizes:
              type: string
              description: Bucket sizes use to configure prometheus.
        smtp_server:
          additionalProperties: false
          type: object
          description: Simple mail transfer protocol.
          required:
            - from
            - host
            - port
            - username
            - password
            - timeout
          properties:
            from:
              type: string
              format: email
              description: the 'from' email address that will be used to send emails
            host:
              type: string
            port:
              type: number
            username:
              type: string
            password:
              type: string
            timeout:
              description: timout to smtp server in milliseconds
              type: number
